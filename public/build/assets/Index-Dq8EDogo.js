import{d as e,e as t,w as s,f as l,g as a,u as r,i as o,j as i,k as d,l as n,m as u,n as c,p as g,q as m,s as p,v as x,t as y,F as v,x as f,y as b,z as h,A as w,B as k,C as _,D as A,E as S,G as j,H as C}from"./vendor-Cy1J3uaY.js";import{_ as D}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-DjBzGfo9.js";import"./ApplicationLogo-DEclvB7y.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const L={class:"py-12"},U={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},E={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},T={class:"p-6 text-gray-900"},V={class:"flex justify-end gap-3 mb-6"},N={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6"},O={class:"col-span-1 md:col-span-2"},I={class:"mt-1 relative rounded-md shadow-sm"},P={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},H=["value"],R={class:"overflow-x-auto ring-1 ring-black ring-opacity-5 sm:rounded-lg"},G={class:"min-w-full divide-y divide-gray-300"},M={class:"bg-white divide-y divide-gray-200"},$=["onClick"],q={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},F={class:"px-6 py-4 whitespace-nowrap"},J={class:"text-sm font-medium text-gray-900"},z={class:"text-xs text-gray-500"},B={class:"px-6 py-4 whitespace-nowrap"},W={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Z={class:"font-medium text-gray-900"},K={key:0,class:"text-xs text-gray-400"},Q=["title"],X={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Y={class:"text-indigo-600 hover:text-indigo-900"},ee={key:0,class:"bg-gray-50"},te={colspan:"6",class:"px-6 py-4"},se={class:"rounded-lg bg-white p-4 shadow-sm border border-gray-200"},le={class:"flex flex-wrap gap-4 text-xs text-gray-500 mb-4 border-b border-gray-100 pb-2"},ae={key:0},re={key:0,class:"mb-2"},oe={class:"overflow-x-auto"},ie={class:"min-w-full divide-y divide-gray-200 text-sm"},de={class:"divide-y divide-gray-200"},ne={class:"px-3 py-2 font-mono text-gray-600"},ue={class:"px-3 py-2 text-red-600 bg-red-50"},ce={class:"px-3 py-2 text-green-600 bg-green-50"},ge={key:0},me={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe={key:0},xe={class:"bg-gray-50 p-2 rounded text-xs"},ye={class:"font-medium text-gray-600"},ve={class:"text-gray-800"},fe={key:1},be={class:"bg-gray-50 p-2 rounded text-xs"},he={class:"font-medium text-gray-600"},we={class:"text-gray-800"},ke={key:2,class:"text-sm text-gray-500 italic"},_e={key:0,class:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-4"},Ae={class:"text-sm text-gray-500"},Se={class:"flex flex-wrap gap-1 justify-center"},je=["innerHTML"],Ce={key:1,class:"mt-8 text-center text-gray-500"},De={key:0,class:"fixed z-50 inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Le={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ue={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},Ee={class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"},Te={class:"mt-3 text-center sm:mt-5"},Ve={class:"mt-4"},Ne={class:"space-y-4"},Oe={class:"text-left"},Ie={class:"space-y-2"},Pe={class:"flex items-center"},He={class:"flex items-center"},Re={key:0,class:"space-y-3 text-left"},Ge=e({__name:"Index",props:{logs:{},filters:{},actions:{}},setup(e){const Ge=e,Me=t(Ge.filters.search||""),$e=t(Ge.filters.action||""),qe=t(Ge.filters.role||""),Fe=t(Ge.filters.model_type||""),Je=t(Ge.filters.start_date||""),ze=t(Ge.filters.end_date||""),Be=t(new Set),We=t(!1),Ze=t("range"),Ke=t(""),Qe=t(""),Xe=((e,t)=>{let s;return(...l)=>{clearTimeout(s),s=setTimeout(()=>e(...l),t)}})(()=>{C.get(route("admin.audit-logs.index"),{search:Me.value,action:$e.value,role:qe.value,model_type:Fe.value,start_date:Je.value,end_date:ze.value},{preserveState:!0,preserveScroll:!0,replace:!0})},300);s([Me,$e,qe,Fe,Je,ze],()=>{Xe()});const Ye=e=>{if(!e)return"-";return(e.split("\\").pop()||e).replace(/([A-Z])/g," $1").trim()},et=e=>{const t=e.old_values||{},s=e.new_values||{},l=new Set([...Object.keys(t),...Object.keys(s)]),a=[];return l.forEach(e=>{let l=t[e],r=s[e];JSON.stringify(l)!==JSON.stringify(r)&&a.push({key:e,old:l,new:r})}),a},tt=e=>null===e?"null":!0===e?"true":!1===e?"false":"object"==typeof e?JSON.stringify(e):e,st=()=>{const e={};Me.value&&(e.search=Me.value),$e.value&&(e.action=$e.value),qe.value&&(e.role=qe.value),Fe.value&&(e.model_type=Fe.value),Je.value&&(e.start_date=Je.value),ze.value&&(e.end_date=ze.value);const t=new URLSearchParams(e),s=route("admin.audit-logs.export");window.location.href=t.toString()?`${s}?${t.toString()}`:s},lt=()=>{We.value=!0,Ke.value=Je.value||"",Qe.value=ze.value||""},at=()=>{We.value=!1,Ze.value="range"},rt=()=>{"range"!==Ze.value||Ke.value&&Qe.value?confirm(`Are you sure you want to clear ${"all"===Ze.value?"ALL":"selected range of"} audit logs? This action cannot be undone.`)&&C.delete(route("admin.audit-logs.clear"),{data:{clear_type:Ze.value,start_date:Ke.value,end_date:Qe.value},onSuccess:()=>{at()},preserveScroll:!0}):alert("Please select both start and end dates for range clear.")};return(t,s)=>(y(),l(v,null,[a(r(o),{title:"Audit Logs"}),a(D,null,{header:i(()=>[...s[9]||(s[9]=[d("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Audit Logs",-1)])]),default:i(()=>[d("div",L,[d("div",U,[d("div",E,[d("div",T,[d("div",V,[d("button",{onClick:st,class:"flex items-center gap-2 rounded-lg bg-bnhs-blue px-4 py-2 text-sm font-medium text-white hover:bg-bnhs-blue-600"},[a(r(c),{class:"h-4 w-4"}),s[10]||(s[10]=u(" Export CSV ",-1))]),d("button",{onClick:lt,class:"flex items-center gap-2 rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700"},[a(r(g),{class:"h-4 w-4"}),s[11]||(s[11]=u(" Clear Logs ",-1))])]),d("div",N,[d("div",O,[s[12]||(s[12]=d("label",{class:"block text-sm font-medium text-gray-700"},"Search",-1)),d("div",I,[d("div",P,[a(r(p),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),m(d("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>Me.value=e),type:"text",class:"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",placeholder:"User, ID, or Description..."},null,512),[[x,Me.value]])])]),d("div",null,[s[14]||(s[14]=d("label",{class:"block text-sm font-medium text-gray-700"},"Action",-1)),m(d("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>$e.value=e),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[s[13]||(s[13]=d("option",{value:""},"All Actions",-1)),(y(!0),l(v,null,f(e.actions,e=>(y(),l("option",{key:e,value:e},b(e),9,H))),128))],512),[[h,$e.value]])]),d("div",null,[s[16]||(s[16]=d("label",{class:"block text-sm font-medium text-gray-700"},"Role",-1)),m(d("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>qe.value=e),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[...s[15]||(s[15]=[d("option",{value:""},"All Roles",-1),d("option",{value:"admin"},"Admin",-1),d("option",{value:"registrar"},"Registrar",-1),d("option",{value:"user"},"User",-1),d("option",{value:"system"},"System",-1)])],512),[[h,qe.value]])]),d("div",null,[s[17]||(s[17]=d("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),m(d("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>Je.value=e),type:"date",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[x,Je.value]])]),d("div",null,[s[18]||(s[18]=d("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),m(d("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>ze.value=e),type:"date",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[x,ze.value]])])]),d("div",R,[d("table",G,[s[27]||(s[27]=d("thead",{class:"bg-gray-50"},[d("tr",null,[d("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Timestamp"),d("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"User"),d("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Action"),d("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),d("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description"),d("th",{scope:"col",class:"relative px-6 py-3"},[d("span",{class:"sr-only"},"Details")])])],-1)),d("tbody",M,[(y(!0),l(v,null,f(e.logs.data,e=>{return y(),l(v,{key:e.id},[d("tr",{onClick:t=>{return s=e.id,void(Be.value.has(s)?Be.value.delete(s):Be.value.add(s));var s},class:"cursor-pointer hover:bg-gray-50 transition-colors"},[d("td",q,b((a=e.created_at,new Date(a).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}))),1),d("td",F,[d("div",J,b(e.user?e.user.name:"System"),1),d("div",z,b((t=e.user_role,t?t.charAt(0).toUpperCase()+t.slice(1):"N/A")),1)]),d("td",B,[d("span",{class:w(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",{"bg-green-100 text-green-800":"CREATE"===e.action,"bg-yellow-100 text-yellow-800":"UPDATE"===e.action,"bg-red-100 text-red-800":"DELETE"===e.action,"bg-blue-100 text-blue-800":"LOGIN"===e.action,"bg-gray-100 text-gray-800":!["CREATE","UPDATE","DELETE","LOGIN"].includes(e.action)}])},b(e.action),3)]),d("td",W,[d("div",Z,b(Ye(e.model_type)),1),e.model_id?(y(),l("div",K,"ID: "+b(e.model_id),1)):n("",!0)]),d("td",{class:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",title:e.description},b(e.description),9,Q),d("td",X,[d("button",Y,[Be.value.has(e.id)?(y(),k(r(_),{key:0,class:"h-5 w-5"})):(y(),k(r(A),{key:1,class:"h-5 w-5"}))])])],8,$),Be.value.has(e.id)?(y(),l("tr",ee,[d("td",te,[d("div",se,[d("div",le,[e.user_id?(y(),l("div",ae,[s[19]||(s[19]=d("strong",null,"User ID:",-1)),u(" "+b(e.user_id),1)])):n("",!0),d("div",null,[s[20]||(s[20]=d("strong",null,"IP:",-1)),u(" "+b(e.ip_address),1)]),d("div",null,[s[21]||(s[21]=d("strong",null,"User Agent:",-1)),u(" "+b(e.user_agent),1)])]),"UPDATE"===e.action&&(e.old_values||e.new_values)?(y(),l("div",re,[s[24]||(s[24]=d("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Changes",-1)),d("div",oe,[d("table",ie,[s[23]||(s[23]=d("thead",{class:"bg-gray-50"},[d("tr",null,[d("th",{class:"px-3 py-2 text-left font-medium text-gray-500"},"Field"),d("th",{class:"px-3 py-2 text-left font-medium text-gray-500"},"Old Value"),d("th",{class:"px-3 py-2 text-left font-medium text-gray-500"},"New Value")])],-1)),d("tbody",de,[(y(!0),l(v,null,f(et(e),e=>(y(),l("tr",{key:e.key},[d("td",ne,b(e.key),1),d("td",ue,b(tt(e.old)),1),d("td",ce,b(tt(e.new)),1)]))),128)),0===et(e).length?(y(),l("tr",ge,[...s[22]||(s[22]=[d("td",{colspan:"3",class:"px-3 py-2 text-gray-500 italic"},"No detected changes or only metadata update.",-1)])])):n("",!0)])])])])):e.new_values||e.old_values?(y(),l("div",me,[e.old_values&&Object.keys(e.old_values).length>0?(y(),l("div",pe,[s[25]||(s[25]=d("h4",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2"},"Previous Data",-1)),d("div",xe,[(y(!0),l(v,null,f(e.old_values,(e,t)=>(y(),l("div",{key:t,class:"flex justify-between py-1 border-b border-gray-100 last:border-0"},[d("span",ye,b(t)+":",1),d("span",ve,b(tt(e)),1)]))),128))])])):n("",!0),e.new_values&&Object.keys(e.new_values).length>0?(y(),l("div",fe,[s[26]||(s[26]=d("h4",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2"},"New Data",-1)),d("div",be,[(y(!0),l(v,null,f(e.new_values,(e,t)=>(y(),l("div",{key:t,class:"flex justify-between py-1 border-b border-gray-100 last:border-0"},[d("span",he,b(t)+":",1),d("span",we,b(tt(e)),1)]))),128))])])):n("",!0)])):(y(),l("div",ke," No additional details captured for this event. "))])])])):n("",!0)],64);var t,a}),128))])])]),e.logs.data.length>0?(y(),l("div",_e,[d("div",Ae," Showing "+b(e.logs.from)+" to "+b(e.logs.to)+" of "+b(e.logs.total)+" logs ",1),d("div",Se,[(y(!0),l(v,null,f(e.logs.links,(e,t)=>(y(),l(v,{key:t},[null===e.url?(y(),l("div",{key:0,class:"px-3 py-1 text-sm text-gray-400 border rounded bg-gray-100",innerHTML:e.label},null,8,je)):(y(),k(r(S),{key:1,href:e.url,class:w(["px-3 py-1 text-sm border rounded hover:bg-gray-50",{"bg-indigo-50 border-indigo-500 text-indigo-700":e.active,"bg-white text-gray-700":!e.active}]),innerHTML:e.label},null,8,["href","class","innerHTML"]))],64))),128))])])):(y(),l("div",Ce," No logs found matching your criteria. "))])])])]),We.value?(y(),l("div",De,[d("div",Le,[d("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:at}),s[35]||(s[35]=d("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),d("div",Ue,[d("div",null,[d("div",Ee,[a(r(g),{class:"h-6 w-6 text-red-600","aria-hidden":"true"})]),d("div",Te,[s[34]||(s[34]=d("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Clear Audit Logs ",-1)),d("div",Ve,[d("div",Ne,[d("div",Oe,[s[30]||(s[30]=d("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Clear Type",-1)),d("div",Ie,[d("label",Pe,[m(d("input",{type:"radio","onUpdate:modelValue":s[5]||(s[5]=e=>Ze.value=e),value:"range",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,512),[[j,Ze.value]]),s[28]||(s[28]=d("span",{class:"ml-2 text-sm text-gray-700"},"Clear by date range",-1))]),d("label",He,[m(d("input",{type:"radio","onUpdate:modelValue":s[6]||(s[6]=e=>Ze.value=e),value:"all",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,512),[[j,Ze.value]]),s[29]||(s[29]=d("span",{class:"ml-2 text-sm text-gray-700"},"Clear all logs",-1))])])]),"range"===Ze.value?(y(),l("div",Re,[d("div",null,[s[31]||(s[31]=d("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),m(d("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>Ke.value=e),type:"date",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:""},null,512),[[x,Ke.value]])]),d("div",null,[s[32]||(s[32]=d("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),m(d("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>Qe.value=e),type:"date",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:""},null,512),[[x,Qe.value]])])])):n("",!0),s[33]||(s[33]=d("div",{class:"text-sm text-red-600"},[d("strong",null,"Warning:"),u(" This action cannot be undone. ")],-1))])])])]),d("div",{class:"mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense"},[d("button",{type:"button",onClick:rt,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:col-start-2 sm:text-sm"}," Clear Logs "),d("button",{type:"button",onClick:at,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm"}," Cancel ")])])])])):n("",!0)]),_:1})],64))}});export{Ge as default};
