import{d as e,O as l,P as s,e as a,Q as t,w as r,J as u,f as o,g as n,u as d,i,j as c,k as m,t as p,F as v,x as g,l as f,E as b,m as y,y as _,q as h,v as x,A as k,z as w,B as q,K as V,L as S,H as U}from"./vendor-Cy1J3uaY.js";import{_ as C}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-DjBzGfo9.js";import{P as j}from"./PrimaryButton-mT-kTcVW.js";import{_ as P}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-DudDiigq.js";import{D as R}from"./DangerButton-CSoQXhkK.js";import{_ as L}from"./TextInput.vue_vue_type_script_setup_true_lang-CkH_Cd5h.js";import{_ as T,a as N}from"./InputError.vue_vue_type_script_setup_true_lang-i5oYyVWA.js";import{_ as E}from"./Modal.vue_vue_type_script_setup_true_lang-CxnnvSpo.js";import{R as A}from"./RequestsTable-B0fdRyLU.js";import"./ApplicationLogo-DEclvB7y.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const D={class:"py-8 pb-12"},$={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},M={class:"flex items-center gap-3"},F={class:"text-sm font-medium text-gray-700"},I=["value"],B={key:0,class:"whitespace-nowrap px-6 py-4"},G=["checked","onChange"],O={key:1,class:"whitespace-nowrap px-6 py-4"},Y={key:2,class:"px-6 py-4"},H={key:0},J={class:"font-medium text-gray-900"},K={class:"text-sm text-gray-500"},z={key:1,class:"space-y-1"},Q=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Z={key:3,class:"whitespace-nowrap px-6 py-4 font-mono text-sm text-gray-500"},ee={key:0},le=["onUpdate:modelValue"],se={key:4,class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ae={key:0},te=["onUpdate:modelValue"],re={key:5,class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},ue={key:6,class:"whitespace-nowrap px-6 py-4"},oe=["src","alt"],ne={key:1,class:"text-gray-400 text-sm"},de={key:7,class:"whitespace-nowrap px-6 py-4"},ie=["onUpdate:modelValue"],ce=["value"],me={key:8,class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},pe={key:9,class:"whitespace-nowrap px-6 py-4 text-right"},ve={key:0,class:"flex justify-end gap-2"},ge=["onClick"],fe={key:1,class:"flex justify-end"},be={key:2,class:"flex justify-end gap-2"},ye=["onClick"],_e=["onClick"],he={class:"p-6"},xe={class:"grid gap-4 sm:grid-cols-2"},ke=["value"],we=["value"],qe={class:"grid gap-4 sm:grid-cols-3"},Ve={class:"grid gap-4 sm:grid-cols-2"},Se=["value"],Ue={class:"grid gap-4 sm:grid-cols-2"},Ce={key:0},je=["required"],Pe=["label"],Re=["value"],Le=["value"],Te={key:0,class:"mt-2"},Ne=["src"],Ee={class:"flex items-center"},Ae={class:"flex justify-end gap-3"},De=e({__name:"Index",props:{requests:{},filters:{},documentTypes:{},gradeLevels:{},trackStrands:{},schoolYears:{}},setup(e){const De=l(),$e=s(()=>De.props.auth.user),Me=s(()=>["admin","superadmin"].includes($e.value?.role)),Fe=s(()=>"superadmin"===$e.value?.role),Ie=e,Be=a(!1),Ge=a(),Oe=a(""),Ye=a(""),He=a(null),Je=a({}),Ke=["Pending","Verified","Processing","Ready","Completed","Rejected"];t(()=>{He.value=null,Je.value={}}),r(()=>Ie.requests.data,()=>{He.value=null},{deep:!0});const ze=u({email:"",first_name:"",middle_name:"",last_name:"",lrn:"",grade_level:"",section:"",track_strand:"",school_year_last_attended:"",purpose:"",photo:null,document_type_id:"",status:"Pending",otp_verified:!1}),Qe=a(null),We=s(()=>"Grade 11"===ze.grade_level||"Grade 12"===ze.grade_level),Xe=Ie.gradeLevels||{},Ze=Ie.trackStrands||{},el=Ie.schoolYears||{},ll=e=>{const l=e.target,s=l.files?.[0];if(s){ze.photo=s;const e=new FileReader;e.onload=e=>{Qe.value=e.target?.result},e.readAsDataURL(s)}},sl=()=>{ze.post(route("registrar.requests.store"),{forceFormData:!0,onSuccess:()=>{Be.value=!1,ze.reset(),Qe.value=null}})},al=()=>{Be.value=!1,ze.reset(),Qe.value=null,ze.clearErrors()},tl=()=>{const e=new URLSearchParams;Object.entries(Ie.filters).forEach(([l,s])=>{s&&e.append(l,String(s))});const l=route("registrar.requests.export");window.location.href=e.toString()?`${l}?${e.toString()}`:l},rl=()=>{const e=Ge.value?.selectedRequests||[];if(0===e.length)return void alert("Please select at least one request.");if(!Oe.value&&!Ye.value)return void alert("Please select a status or enter notes to update.");const l=[];Oe.value&&l.push(`status to "${Oe.value}"`),Ye.value&&l.push("notes");const s=l.join(" and ");confirm(`Update ${s} for ${e.length} request(s)?`)&&U.post(route("registrar.requests.bulk-update"),{request_ids:e,status:Oe.value||void 0,admin_remarks:Ye.value||void 0},{onSuccess:()=>{Ge.value&&Ge.value.clearSelection(),Oe.value="",Ye.value=""}})},ul=()=>{const e=Ge.value?.selectedRequests||[];0!==e.length?confirm(`Are you sure you want to delete ${e.length} request(s)? This action cannot be undone.`)&&U.post(route("registrar.requests.bulk-delete"),{request_ids:e},{onSuccess:()=>{Ge.value&&Ge.value.clearSelection()}}):alert("Please select at least one request.")};return(l,s)=>(p(),o(v,null,[n(d(i),{title:"Manage Requests"}),n(C,null,{header:c(()=>[...s[18]||(s[18]=[m("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Manage Requests ",-1)])]),default:c(()=>[m("div",D,[m("div",$,[n(A,{ref_key:"requestsTable",ref:Ge,requests:e.requests,filters:e.filters,statuses:Ke,documentTypes:e.documentTypes,isSuperadmin:Me.value,routePrefix:"registrar.requests",onExport:tl,onCreateRequest:s[3]||(s[3]=e=>Be.value=!0)},{"bulk-actions":c(({selectedRequests:e})=>[m("div",M,[m("span",F,_(e.length)+" selected ",1),h(m("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>Oe.value=e),class:"rounded-lg border-gray-300 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[19]||(s[19]=m("option",{value:""},"Update Status",-1)),(p(),o(v,null,g(Ke,e=>m("option",{key:e,value:e},_(e),9,I)),64))],512),[[w,Oe.value]]),h(m("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>Ye.value=e),type:"text",placeholder:"Add notes...",class:"rounded-lg border-gray-300 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},null,512),[[x,Ye.value]]),n(j,{onClick:rl,disabled:!Oe.value&&!Ye.value,class:"whitespace-nowrap"},{default:c(()=>[...s[20]||(s[20]=[y(" Apply ",-1)])]),_:1},8,["disabled"]),Me.value?(p(),q(R,{key:0,onClick:ul,class:"whitespace-nowrap"},{default:c(()=>[...s[21]||(s[21]=[y(" Delete ",-1)])]),_:1})):f("",!0),n(P,{onClick:l=>(e=>{if(0===e.length)return void alert("Please select at least one request.");const l=new URLSearchParams;e.forEach(e=>l.append("ids[]",e.toString()));const s=route("registrar.requests.export");window.location.href=`${s}?${l.toString()}`})(e),class:"whitespace-nowrap"},{default:c(()=>[...s[22]||(s[22]=[y(" Export ",-1)])]),_:1},8,["onClick"]),m("button",{onClick:s[2]||(s[2]=e=>{Ge.value.clearSelection(),Oe.value="",Ye.value=""}),class:"ml-2 text-gray-400 hover:text-gray-600"},[...s[23]||(s[23]=[m("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),"table-rows":c(({columnVisibility:a,isSelected:t,toggleSelect:r,getStatusColor:u,formatDate:i})=>[(p(!0),o(v,null,g(e.requests.data,q=>(p(),o("tr",{key:q.id,class:"hover:bg-gray-50"},[a.checkbox?(p(),o("td",B,[m("input",{type:"checkbox",checked:t(q.id),onChange:e=>r(q.id),class:"rounded border-gray-300 text-bnhs-blue focus:ring-bnhs-blue"},null,40,G)])):f("",!0),a.tracking_id?(p(),o("td",O,[n(d(b),{href:l.route("registrar.requests.show",{id:q.id,...e.filters}),class:"font-mono font-medium text-bnhs-blue hover:underline"},{default:c(()=>[y(_(q.tracking_id),1)]),_:2},1032,["href"])])):f("",!0),a.requester?(p(),o("td",Y,[Fe.value&&He.value===q.id?(p(),o("div",z,[h(m("input",{"onUpdate:modelValue":e=>Je.value[q.id].first_name=e,type:"text",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"First Name"},null,8,Q),[[x,Je.value[q.id].first_name]]),h(m("input",{"onUpdate:modelValue":e=>Je.value[q.id].middle_name=e,type:"text",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"Middle Name"},null,8,W),[[x,Je.value[q.id].middle_name]]),h(m("input",{"onUpdate:modelValue":e=>Je.value[q.id].last_name=e,type:"text",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"Last Name"},null,8,X),[[x,Je.value[q.id].last_name]])])):(p(),o("div",H,[m("p",J,_(q.first_name)+" "+_(q.middle_name?q.middle_name.charAt(0)+".":"")+" "+_(q.last_name),1),m("p",K,_(q.student_email),1)]))])):f("",!0),a.lrn?(p(),o("td",Z,[Fe.value&&He.value===q.id?h((p(),o("input",{key:1,"onUpdate:modelValue":e=>Je.value[q.id].lrn=e,type:"text",maxlength:"12",class:"w-24 rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"LRN"},null,8,le)),[[x,Je.value[q.id].lrn]]):(p(),o("span",ee,_(q.lrn),1))])):f("",!0),a.email?(p(),o("td",se,[Fe.value&&He.value===q.id?h((p(),o("input",{key:1,"onUpdate:modelValue":e=>Je.value[q.id].email=e,type:"email",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"Email"},null,8,te)),[[x,Je.value[q.id].email]]):(p(),o("span",ae,_(q.student_email),1))])):f("",!0),a.document?(p(),o("td",re,_(q.document_type?.name),1)):f("",!0),a.signature?(p(),o("td",ue,[q.signature?(p(),o("img",{key:0,src:q.signature,alt:`${q.first_name}'s signature`,class:"h-10 max-w-xs rounded border border-gray-200 object-contain"},null,8,oe)):(p(),o("span",ne,"No signature"))])):f("",!0),a.status?(p(),o("td",de,[Fe.value&&He.value===q.id?h((p(),o("select",{key:1,"onUpdate:modelValue":e=>Je.value[q.id].status=e,class:"rounded border-gray-300 px-2 py-1 text-xs focus:border-bnhs-blue focus:ring-bnhs-blue"},[(p(),o(v,null,g(Ke,e=>m("option",{key:e,value:e},_(e),9,ce)),64))],8,ie)),[[w,Je.value[q.id].status]]):(p(),o("span",{key:0,class:k(["rounded-full px-2 py-1 text-xs font-medium",u(q.status)])},_(q.status),3))])):f("",!0),a.date?(p(),o("td",me,_(i(q.created_at)),1)):f("",!0),a.actions?(p(),o("td",pe,[Fe.value&&He.value!==q.id?(p(),o("div",ve,[m("button",{onClick:e=>(e=>{He.value=e.id,Je.value[e.id]||(Je.value[e.id]={first_name:e.first_name||"",middle_name:e.middle_name||"",last_name:e.last_name||"",email:e.student_email||"",lrn:e.lrn||"",status:e.status||"Pending"})})(q),class:"text-bnhs-blue hover:underline text-sm"}," Edit ",8,ge),n(d(b),{href:l.route("registrar.requests.show",{id:q.id,...e.filters}),class:"text-bnhs-blue hover:underline text-sm"},{default:c(()=>[...s[24]||(s[24]=[y(" View ",-1)])]),_:1},8,["href"])])):Fe.value?(p(),o("div",be,[m("button",{onClick:e=>(e=>{const l=Je.value[e];l&&U.patch(route("registrar.requests.update",e),l,{preserveScroll:!0,onSuccess:()=>{He.value=null,delete Je.value[e]}})})(q.id),class:"text-green-600 hover:text-green-800 text-sm font-medium"}," Save ",8,ye),m("button",{onClick:e=>{return l=q.id,He.value=null,void delete Je.value[l];var l},class:"text-gray-600 hover:text-gray-800 text-sm"}," Cancel ",8,_e)])):(p(),o("div",fe,[n(d(b),{href:l.route("registrar.requests.show",q.id),class:"text-bnhs-blue hover:underline text-sm"},{default:c(()=>[...s[25]||(s[25]=[y(" View ",-1)])]),_:1},8,["href"])]))])):f("",!0)]))),128))]),_:1},8,["requests","filters","documentTypes","isSuperadmin"])])]),n(E,{show:Be.value,onClose:al,"max-width":"2xl"},{default:c(()=>[m("div",he,[s[34]||(s[34]=m("h2",{class:"mb-4 text-lg font-semibold text-gray-900"},"Create New Request",-1)),m("form",{onSubmit:V(sl,["prevent"]),class:"space-y-6"},[m("div",xe,[m("div",null,[n(T,{for:"document_type_id",value:"Document Type *"}),h(m("select",{id:"document_type_id","onUpdate:modelValue":s[4]||(s[4]=e=>d(ze).document_type_id=e),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[26]||(s[26]=m("option",{value:""},"Select Document Type",-1)),(p(!0),o(v,null,g(e.documentTypes,e=>(p(),o("option",{key:e.id,value:e.id},_(e.name),9,ke))),128))],512),[[w,d(ze).document_type_id]]),n(N,{message:d(ze).errors.document_type_id},null,8,["message"])]),m("div",null,[n(T,{for:"status",value:"Status"}),h(m("select",{id:"status","onUpdate:modelValue":s[5]||(s[5]=e=>d(ze).status=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[(p(),o(v,null,g(Ke,e=>m("option",{key:e,value:e},_(e),9,we)),64))],512),[[w,d(ze).status]]),n(N,{message:d(ze).errors.status},null,8,["message"])])]),m("div",null,[n(T,{for:"email",value:"Email *"}),n(L,{id:"email",modelValue:d(ze).email,"onUpdate:modelValue":s[6]||(s[6]=e=>d(ze).email=e),type:"email",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(N,{message:d(ze).errors.email},null,8,["message"])]),m("div",null,[s[27]||(s[27]=m("h3",{class:"mb-3 text-md font-medium text-gray-700"},"Personal Information",-1)),m("div",qe,[m("div",null,[n(T,{for:"first_name",value:"First Name *"}),n(L,{id:"first_name",modelValue:d(ze).first_name,"onUpdate:modelValue":s[7]||(s[7]=e=>d(ze).first_name=e),required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(N,{message:d(ze).errors.first_name},null,8,["message"])]),m("div",null,[n(T,{for:"middle_name",value:"Middle Name"}),n(L,{id:"middle_name",modelValue:d(ze).middle_name,"onUpdate:modelValue":s[8]||(s[8]=e=>d(ze).middle_name=e),class:"mt-1 block w-full"},null,8,["modelValue"]),n(N,{message:d(ze).errors.middle_name},null,8,["message"])]),m("div",null,[n(T,{for:"last_name",value:"Last Name *"}),n(L,{id:"last_name",modelValue:d(ze).last_name,"onUpdate:modelValue":s[9]||(s[9]=e=>d(ze).last_name=e),required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(N,{message:d(ze).errors.last_name},null,8,["message"])])])]),m("div",Ve,[m("div",null,[n(T,{for:"lrn",value:"LRN (12 digits) *"}),n(L,{id:"lrn",modelValue:d(ze).lrn,"onUpdate:modelValue":s[10]||(s[10]=e=>d(ze).lrn=e),type:"text",maxlength:"12",pattern:"[0-9]{12}",required:"",class:"mt-1 block w-full",onInput:s[11]||(s[11]=e=>d(ze).lrn=e.target.value.replace(/\D/g,"").slice(0,12))},null,8,["modelValue"]),n(N,{message:d(ze).errors.lrn},null,8,["message"])]),m("div",null,[n(T,{for:"grade_level",value:"Grade Level *"}),h(m("select",{id:"grade_level","onUpdate:modelValue":s[12]||(s[12]=e=>d(ze).grade_level=e),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[28]||(s[28]=m("option",{value:""},"Select Grade Level",-1)),(p(!0),o(v,null,g(d(Xe),(e,l)=>(p(),o("option",{key:l,value:l},_(e),9,Se))),128))],512),[[w,d(ze).grade_level]]),n(N,{message:d(ze).errors.grade_level},null,8,["message"])])]),m("div",Ue,[m("div",null,[n(T,{for:"section",value:"Section *"}),n(L,{id:"section",modelValue:d(ze).section,"onUpdate:modelValue":s[13]||(s[13]=e=>d(ze).section=e),required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(N,{message:d(ze).errors.section},null,8,["message"])]),We.value?(p(),o("div",Ce,[n(T,{for:"track_strand",value:"Track/Strand *"}),h(m("select",{id:"track_strand","onUpdate:modelValue":s[14]||(s[14]=e=>d(ze).track_strand=e),required:We.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[29]||(s[29]=m("option",{value:""},"Select Track/Strand",-1)),(p(!0),o(v,null,g(d(Ze),(e,l)=>(p(),o("optgroup",{key:l,label:l},[(p(!0),o(v,null,g(e,(e,l)=>(p(),o("option",{key:l,value:l},_(e),9,Re))),128))],8,Pe))),128))],8,je),[[w,d(ze).track_strand]]),n(N,{message:d(ze).errors.track_strand},null,8,["message"])])):f("",!0)]),m("div",null,[n(T,{for:"school_year_last_attended",value:"School Year Last Attended *"}),h(m("select",{id:"school_year_last_attended","onUpdate:modelValue":s[15]||(s[15]=e=>d(ze).school_year_last_attended=e),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[30]||(s[30]=m("option",{value:""},"Select School Year",-1)),(p(!0),o(v,null,g(d(el),(e,l)=>(p(),o("option",{key:l,value:l},_(e),9,Le))),128))],512),[[w,d(ze).school_year_last_attended]]),n(N,{message:d(ze).errors.school_year_last_attended},null,8,["message"])]),m("div",null,[n(T,{for:"purpose",value:"Purpose *"}),h(m("textarea",{id:"purpose","onUpdate:modelValue":s[16]||(s[16]=e=>d(ze).purpose=e),required:"",rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},null,512),[[x,d(ze).purpose]]),n(N,{message:d(ze).errors.purpose},null,8,["message"])]),m("div",null,[n(T,{for:"photo",value:"Photo (Optional)"}),m("input",{id:"photo",type:"file",accept:"image/*",onChange:ll,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-bnhs-blue file:px-4 file:py-2 file:text-sm file:font-semibold file:text-white hover:file:bg-bnhs-blue-600"},null,32),n(N,{message:d(ze).errors.photo},null,8,["message"]),Qe.value?(p(),o("div",Te,[m("img",{src:Qe.value,alt:"Preview",class:"h-32 w-32 rounded-md object-cover"},null,8,Ne)])):f("",!0)]),m("div",null,[m("label",Ee,[h(m("input",{type:"checkbox","onUpdate:modelValue":s[17]||(s[17]=e=>d(ze).otp_verified=e),class:"rounded border-gray-300 text-bnhs-blue focus:ring-bnhs-blue"},null,512),[[S,d(ze).otp_verified]]),s[31]||(s[31]=m("span",{class:"ml-2 text-sm text-gray-600"},"OTP Verified",-1))])]),m("div",Ae,[n(P,{type:"button",onClick:al},{default:c(()=>[...s[32]||(s[32]=[y(" Cancel ",-1)])]),_:1}),n(j,{type:"submit",disabled:d(ze).processing},{default:c(()=>[...s[33]||(s[33]=[y(" Create Request ",-1)])]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"])]),_:1})],64))}});export{De as default};
