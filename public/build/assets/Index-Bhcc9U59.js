import{g as e,J as l,K as s,i as a,L as t,w as r,D as o,c as u,j as n,u as d,k as i,l as c,a as m,o as p,F as v,q as f,m as g,z as b,n as h,t as _,p as y,v as x,x as k,s as w,y as q,E as V,G as S,B as U}from"./vendor-D2a9Ooci.js";import{_ as C}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-BxbCq07Z.js";import{P as j}from"./PrimaryButton-UITzHXSJ.js";import{_ as P}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-CUhaWGbd.js";import{D as R}from"./DangerButton-tDFAqI1F.js";import{_ as L}from"./TextInput.vue_vue_type_script_setup_true_lang-BSw9Jizz.js";import{_ as T,a as D}from"./InputError.vue_vue_type_script_setup_true_lang-DWHY4Rxb.js";import{_ as E}from"./Modal.vue_vue_type_script_setup_true_lang-Dh8_5UAY.js";import{R as M}from"./RequestsTable-CfxUNP23.js";import"./ApplicationLogo-8ola3r45.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const N={class:"py-8 pb-12"},A={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},$={class:"flex items-center gap-3"},B={class:"text-sm font-medium text-gray-700"},G=["value"],I={key:0,class:"whitespace-nowrap px-6 py-4"},F=["checked","onChange"],O={key:1,class:"whitespace-nowrap px-6 py-4"},Y={key:2,class:"px-6 py-4"},z={key:0},J={class:"font-medium text-gray-900"},K={class:"text-sm text-gray-500"},H={key:1,class:"space-y-1"},Q=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Z={key:3,class:"whitespace-nowrap px-6 py-4 font-mono text-sm text-gray-500"},ee={key:0},le=["onUpdate:modelValue"],se={key:4,class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},ae={key:0},te=["onUpdate:modelValue"],re={key:5,class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},oe={key:6,class:"whitespace-nowrap px-6 py-4"},ue=["onUpdate:modelValue"],ne=["value"],de={key:7,class:"whitespace-nowrap px-6 py-4"},ie={key:0,class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ce={key:1,class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me={key:8,class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},pe={key:9,class:"whitespace-nowrap px-6 py-4 text-right"},ve={key:0,class:"flex justify-end gap-2"},fe=["onClick"],ge={key:1,class:"flex justify-end"},be={key:2,class:"flex justify-end gap-2"},he=["onClick"],_e=["onClick"],ye={class:"p-6"},xe={class:"grid gap-4 sm:grid-cols-2"},ke=["value"],we=["value"],qe={class:"grid gap-4 sm:grid-cols-3"},Ve={class:"grid gap-4 sm:grid-cols-2"},Se=["value"],Ue={class:"grid gap-4 sm:grid-cols-2"},Ce={key:0},je=["required"],Pe=["label"],Re=["value"],Le=["value"],Te={key:0,class:"mt-2"},De=["src"],Ee={class:"flex items-center"},Me={class:"flex justify-end gap-3"},Ne=e({__name:"Index",props:{requests:{},filters:{},documentTypes:{},gradeLevels:{},trackStrands:{},schoolYears:{}},setup(e){const Ne=l(),Ae=s(()=>Ne.props.auth.user),$e=s(()=>["admin","superadmin"].includes(Ae.value?.role)),Be=e,Ge=a(!1),Ie=a(),Fe=a(""),Oe=a(""),Ye=a(null),ze=a({}),Je=["Pending","Verified","Processing","Ready","Completed","Rejected"];t(()=>{Ye.value=null,ze.value={}}),r(()=>Be.requests.data,()=>{Ye.value=null},{deep:!0});const Ke=o({email:"",first_name:"",middle_name:"",last_name:"",lrn:"",grade_level:"",section:"",track_strand:"",school_year_last_attended:"",purpose:"",photo:null,document_type_id:"",status:"Pending",otp_verified:!1}),He=a(null),Qe=s(()=>"Grade 11"===Ke.grade_level||"Grade 12"===Ke.grade_level),We=Be.gradeLevels||{},Xe=Be.trackStrands||{},Ze=Be.schoolYears||{},el=e=>{const l=e.target,s=l.files?.[0];if(s){Ke.photo=s;const e=new FileReader;e.onload=e=>{He.value=e.target?.result},e.readAsDataURL(s)}},ll=()=>{Ke.post(route("admin.requests.store"),{forceFormData:!0,onSuccess:()=>{Ge.value=!1,Ke.reset(),He.value=null}})},sl=()=>{Ge.value=!1,Ke.reset(),He.value=null,Ke.clearErrors()},al=()=>{const e=new URLSearchParams;Object.entries(Be.filters).forEach(([l,s])=>{s&&e.append(l,String(s))});const l=route("admin.requests.export");window.location.href=e.toString()?`${l}?${e.toString()}`:l},tl=()=>{const e=Ie.value?.selectedRequests||[];if(0===e.length)return void alert("Please select at least one request.");if(!Fe.value&&!Oe.value)return void alert("Please select a status or enter notes to update.");const l=[];Fe.value&&l.push(`status to "${Fe.value}"`),Oe.value&&l.push("notes");const s=l.join(" and ");confirm(`Update ${s} for ${e.length} request(s)?`)&&U.post(route("admin.requests.bulk"),{action:"status_update",request_ids:e,status:Fe.value||void 0,admin_remarks:Oe.value||void 0},{onSuccess:()=>{Ie.value&&Ie.value.clearSelection(),Fe.value="",Oe.value=""}})},rl=()=>{const e=Ie.value?.selectedRequests||[];0!==e.length?confirm(`Are you sure you want to delete ${e.length} request(s)? This action cannot be undone.`)&&U.post(route("admin.requests.bulk"),{action:"delete",request_ids:e},{onSuccess:()=>{Ie.value&&Ie.value.clearSelection()}}):alert("Please select at least one request.")};return(l,s)=>(p(),u(v,null,[n(d(i),{title:"Manage Requests"}),n(C,null,{header:c(()=>[...s[18]||(s[18]=[m("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Manage Requests ",-1)])]),default:c(()=>[m("div",N,[m("div",A,[n(M,{ref_key:"requestsTable",ref:Ie,requests:e.requests,filters:e.filters,statuses:Je,documentTypes:e.documentTypes,isSuperadmin:$e.value,routePrefix:"admin.requests",onExport:al,onCreateRequest:s[3]||(s[3]=e=>Ge.value=!0)},{"bulk-actions":c(({selectedRequests:e})=>[m("div",$,[m("span",B,_(e.length)+" selected ",1),y(m("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>Fe.value=e),class:"rounded-lg border-gray-300 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[19]||(s[19]=m("option",{value:""},"Update Status",-1)),(p(),u(v,null,f(Je,e=>m("option",{key:e,value:e},_(e),9,G)),64))],512),[[w,Fe.value]]),y(m("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>Oe.value=e),type:"text",placeholder:"Add notes...",class:"rounded-lg border-gray-300 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},null,512),[[x,Oe.value]]),n(j,{onClick:tl,disabled:!Fe.value&&!Oe.value,class:"whitespace-nowrap"},{default:c(()=>[...s[20]||(s[20]=[h(" Apply ",-1)])]),_:1},8,["disabled"]),$e.value?(p(),q(R,{key:0,onClick:rl,class:"whitespace-nowrap"},{default:c(()=>[...s[21]||(s[21]=[h(" Delete ",-1)])]),_:1})):g("",!0),n(P,{onClick:l=>(e=>{if(0===e.length)return void alert("Please select at least one request.");const l=new URLSearchParams;e.forEach(e=>l.append("ids[]",e.toString()));const s=route("admin.requests.export");window.location.href=`${s}?${l.toString()}`})(e),class:"whitespace-nowrap"},{default:c(()=>[...s[22]||(s[22]=[h(" Export ",-1)])]),_:1},8,["onClick"]),m("button",{onClick:s[2]||(s[2]=e=>{Ie.value.clearSelection(),Fe.value="",Oe.value=""}),class:"ml-2 text-gray-400 hover:text-gray-600"},[...s[23]||(s[23]=[m("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),"table-rows":c(({columnVisibility:a,isSelected:t,toggleSelect:r,getStatusColor:o,formatDate:i})=>[(p(!0),u(v,null,f(e.requests.data,q=>(p(),u("tr",{key:q.id,class:"hover:bg-gray-50"},[a.checkbox?(p(),u("td",I,[m("input",{type:"checkbox",checked:t(q.id),onChange:e=>r(q.id),class:"rounded border-gray-300 text-bnhs-blue focus:ring-bnhs-blue"},null,40,F)])):g("",!0),a.tracking_id?(p(),u("td",O,[n(d(b),{href:l.route("admin.requests.show",{id:q.id,...e.filters}),class:"font-mono font-medium text-bnhs-blue hover:underline"},{default:c(()=>[h(_(q.tracking_id),1)]),_:2},1032,["href"])])):g("",!0),a.requester?(p(),u("td",Y,[$e.value&&Ye.value===q.id?(p(),u("div",H,[y(m("input",{"onUpdate:modelValue":e=>ze.value[q.id].first_name=e,type:"text",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"First Name"},null,8,Q),[[x,ze.value[q.id].first_name]]),y(m("input",{"onUpdate:modelValue":e=>ze.value[q.id].middle_name=e,type:"text",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"Middle Name"},null,8,W),[[x,ze.value[q.id].middle_name]]),y(m("input",{"onUpdate:modelValue":e=>ze.value[q.id].last_name=e,type:"text",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"Last Name"},null,8,X),[[x,ze.value[q.id].last_name]])])):(p(),u("div",z,[m("p",J,_(q.first_name)+" "+_(q.middle_name?q.middle_name.charAt(0)+".":"")+" "+_(q.last_name),1),m("p",K,_(q.student_email),1)]))])):g("",!0),a.lrn?(p(),u("td",Z,[$e.value&&Ye.value===q.id?y((p(),u("input",{key:1,"onUpdate:modelValue":e=>ze.value[q.id].lrn=e,type:"text",maxlength:"12",class:"w-24 rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"LRN"},null,8,le)),[[x,ze.value[q.id].lrn]]):(p(),u("span",ee,_(q.lrn),1))])):g("",!0),a.email?(p(),u("td",se,[$e.value&&Ye.value===q.id?y((p(),u("input",{key:1,"onUpdate:modelValue":e=>ze.value[q.id].email=e,type:"email",class:"w-full rounded border-gray-300 px-2 py-1 text-sm focus:border-bnhs-blue focus:ring-bnhs-blue",placeholder:"Email"},null,8,te)),[[x,ze.value[q.id].email]]):(p(),u("span",ae,_(q.student_email),1))])):g("",!0),a.document?(p(),u("td",re,_(q.document_type?.name),1)):g("",!0),a.status?(p(),u("td",oe,[$e.value&&Ye.value===q.id?y((p(),u("select",{key:1,"onUpdate:modelValue":e=>ze.value[q.id].status=e,class:"rounded border-gray-300 px-2 py-1 text-xs focus:border-bnhs-blue focus:ring-bnhs-blue"},[(p(),u(v,null,f(Je,e=>m("option",{key:e,value:e},_(e),9,ne)),64))],8,ue)),[[w,ze.value[q.id].status]]):(p(),u("span",{key:0,class:k(["rounded-full px-2 py-1 text-xs font-medium",o(q.status)])},_(q.status),3))])):g("",!0),a.otp_verified&&$e.value?(p(),u("td",de,[m("span",{class:k(q.otp_verified?"text-green-600":"text-red-600")},[q.otp_verified?(p(),u("svg",ie,[...s[24]||(s[24]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(p(),u("svg",ce,[...s[25]||(s[25]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2)])):g("",!0),a.date?(p(),u("td",me,_(i(q.created_at)),1)):g("",!0),a.actions?(p(),u("td",pe,[$e.value&&Ye.value!==q.id?(p(),u("div",ve,[m("button",{onClick:e=>(e=>{Ye.value=e.id,ze.value[e.id]||(ze.value[e.id]={first_name:e.first_name||"",middle_name:e.middle_name||"",last_name:e.last_name||"",email:e.student_email||"",lrn:e.lrn||"",status:e.status||"Pending"})})(q),class:"text-bnhs-blue hover:underline text-sm"}," Edit ",8,fe),n(d(b),{href:l.route("admin.requests.show",{id:q.id,...e.filters}),class:"text-bnhs-blue hover:underline text-sm"},{default:c(()=>[...s[26]||(s[26]=[h(" View ",-1)])]),_:1},8,["href"])])):$e.value?(p(),u("div",be,[m("button",{onClick:e=>(e=>{const l=ze.value[e];l&&U.patch(route("admin.requests.update",e),l,{preserveScroll:!0,onSuccess:()=>{Ye.value=null,delete ze.value[e]}})})(q.id),class:"text-green-600 hover:text-green-800 text-sm font-medium"}," Save ",8,he),m("button",{onClick:e=>{return l=q.id,Ye.value=null,void delete ze.value[l];var l},class:"text-gray-600 hover:text-gray-800 text-sm"}," Cancel ",8,_e)])):(p(),u("div",ge,[n(d(b),{href:l.route("admin.requests.show",q.id),class:"text-bnhs-blue hover:underline text-sm"},{default:c(()=>[...s[27]||(s[27]=[h(" View ",-1)])]),_:1},8,["href"])]))])):g("",!0)]))),128))]),_:1},8,["requests","filters","documentTypes","isSuperadmin"])])]),n(E,{show:Ge.value,onClose:sl,"max-width":"2xl"},{default:c(()=>[m("div",ye,[s[36]||(s[36]=m("h2",{class:"mb-4 text-lg font-semibold text-gray-900"},"Create New Request",-1)),m("form",{onSubmit:V(ll,["prevent"]),class:"space-y-6"},[m("div",xe,[m("div",null,[n(T,{for:"document_type_id",value:"Document Type *"}),y(m("select",{id:"document_type_id","onUpdate:modelValue":s[4]||(s[4]=e=>d(Ke).document_type_id=e),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[28]||(s[28]=m("option",{value:""},"Select Document Type",-1)),(p(!0),u(v,null,f(e.documentTypes,e=>(p(),u("option",{key:e.id,value:e.id},_(e.name),9,ke))),128))],512),[[w,d(Ke).document_type_id]]),n(D,{message:d(Ke).errors.document_type_id},null,8,["message"])]),m("div",null,[n(T,{for:"status",value:"Status"}),y(m("select",{id:"status","onUpdate:modelValue":s[5]||(s[5]=e=>d(Ke).status=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[(p(),u(v,null,f(Je,e=>m("option",{key:e,value:e},_(e),9,we)),64))],512),[[w,d(Ke).status]]),n(D,{message:d(Ke).errors.status},null,8,["message"])])]),m("div",null,[n(T,{for:"email",value:"Email *"}),n(L,{id:"email",modelValue:d(Ke).email,"onUpdate:modelValue":s[6]||(s[6]=e=>d(Ke).email=e),type:"email",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(D,{message:d(Ke).errors.email},null,8,["message"])]),m("div",null,[s[29]||(s[29]=m("h3",{class:"mb-3 text-md font-medium text-gray-700"},"Personal Information",-1)),m("div",qe,[m("div",null,[n(T,{for:"first_name",value:"First Name *"}),n(L,{id:"first_name",modelValue:d(Ke).first_name,"onUpdate:modelValue":s[7]||(s[7]=e=>d(Ke).first_name=e),required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(D,{message:d(Ke).errors.first_name},null,8,["message"])]),m("div",null,[n(T,{for:"middle_name",value:"Middle Name"}),n(L,{id:"middle_name",modelValue:d(Ke).middle_name,"onUpdate:modelValue":s[8]||(s[8]=e=>d(Ke).middle_name=e),class:"mt-1 block w-full"},null,8,["modelValue"]),n(D,{message:d(Ke).errors.middle_name},null,8,["message"])]),m("div",null,[n(T,{for:"last_name",value:"Last Name *"}),n(L,{id:"last_name",modelValue:d(Ke).last_name,"onUpdate:modelValue":s[9]||(s[9]=e=>d(Ke).last_name=e),required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(D,{message:d(Ke).errors.last_name},null,8,["message"])])])]),m("div",Ve,[m("div",null,[n(T,{for:"lrn",value:"LRN (12 digits) *"}),n(L,{id:"lrn",modelValue:d(Ke).lrn,"onUpdate:modelValue":s[10]||(s[10]=e=>d(Ke).lrn=e),type:"text",maxlength:"12",pattern:"[0-9]{12}",required:"",class:"mt-1 block w-full",onInput:s[11]||(s[11]=e=>d(Ke).lrn=e.target.value.replace(/\D/g,"").slice(0,12))},null,8,["modelValue"]),n(D,{message:d(Ke).errors.lrn},null,8,["message"])]),m("div",null,[n(T,{for:"grade_level",value:"Grade Level *"}),y(m("select",{id:"grade_level","onUpdate:modelValue":s[12]||(s[12]=e=>d(Ke).grade_level=e),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[30]||(s[30]=m("option",{value:""},"Select Grade Level",-1)),(p(!0),u(v,null,f(d(We),(e,l)=>(p(),u("option",{key:l,value:l},_(e),9,Se))),128))],512),[[w,d(Ke).grade_level]]),n(D,{message:d(Ke).errors.grade_level},null,8,["message"])])]),m("div",Ue,[m("div",null,[n(T,{for:"section",value:"Section *"}),n(L,{id:"section",modelValue:d(Ke).section,"onUpdate:modelValue":s[13]||(s[13]=e=>d(Ke).section=e),required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),n(D,{message:d(Ke).errors.section},null,8,["message"])]),Qe.value?(p(),u("div",Ce,[n(T,{for:"track_strand",value:"Track/Strand *"}),y(m("select",{id:"track_strand","onUpdate:modelValue":s[14]||(s[14]=e=>d(Ke).track_strand=e),required:Qe.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[31]||(s[31]=m("option",{value:""},"Select Track/Strand",-1)),(p(!0),u(v,null,f(d(Xe),(e,l)=>(p(),u("optgroup",{key:l,label:l},[(p(!0),u(v,null,f(e,(e,l)=>(p(),u("option",{key:l,value:l},_(e),9,Re))),128))],8,Pe))),128))],8,je),[[w,d(Ke).track_strand]]),n(D,{message:d(Ke).errors.track_strand},null,8,["message"])])):g("",!0)]),m("div",null,[n(T,{for:"school_year_last_attended",value:"School Year Last Attended *"}),y(m("select",{id:"school_year_last_attended","onUpdate:modelValue":s[15]||(s[15]=e=>d(Ke).school_year_last_attended=e),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},[s[32]||(s[32]=m("option",{value:""},"Select School Year",-1)),(p(!0),u(v,null,f(d(Ze),(e,l)=>(p(),u("option",{key:l,value:l},_(e),9,Le))),128))],512),[[w,d(Ke).school_year_last_attended]]),n(D,{message:d(Ke).errors.school_year_last_attended},null,8,["message"])]),m("div",null,[n(T,{for:"purpose",value:"Purpose *"}),y(m("textarea",{id:"purpose","onUpdate:modelValue":s[16]||(s[16]=e=>d(Ke).purpose=e),required:"",rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-bnhs-blue focus:ring-bnhs-blue"},null,512),[[x,d(Ke).purpose]]),n(D,{message:d(Ke).errors.purpose},null,8,["message"])]),m("div",null,[n(T,{for:"photo",value:"Photo (Optional)"}),m("input",{id:"photo",type:"file",accept:"image/*",onChange:el,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-bnhs-blue file:px-4 file:py-2 file:text-sm file:font-semibold file:text-white hover:file:bg-bnhs-blue-600"},null,32),n(D,{message:d(Ke).errors.photo},null,8,["message"]),He.value?(p(),u("div",Te,[m("img",{src:He.value,alt:"Preview",class:"h-32 w-32 rounded-md object-cover"},null,8,De)])):g("",!0)]),m("div",null,[m("label",Ee,[y(m("input",{type:"checkbox","onUpdate:modelValue":s[17]||(s[17]=e=>d(Ke).otp_verified=e),class:"rounded border-gray-300 text-bnhs-blue focus:ring-bnhs-blue"},null,512),[[S,d(Ke).otp_verified]]),s[33]||(s[33]=m("span",{class:"ml-2 text-sm text-gray-600"},"OTP Verified",-1))])]),m("div",Me,[n(P,{type:"button",onClick:sl},{default:c(()=>[...s[34]||(s[34]=[h(" Cancel ",-1)])]),_:1}),n(j,{type:"submit",disabled:d(Ke).processing},{default:c(()=>[...s[35]||(s[35]=[h(" Create Request ",-1)])]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"])]),_:1})],64))}});export{Ne as default};
